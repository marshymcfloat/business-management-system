// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id String @id @default(cuid())

  username String? @unique
  email    String  @unique
  password String

  processedTransactions Transaction[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Customer {
  id String @id @default(cuid())

  name  String
  phone String? @unique

  transactions Transaction[]

  voucher Voucher[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Branch {
  id    String @id @default(cuid())
  title String

  services     ServiceUnit[]
  transactions Transaction[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ServiceUnit {
  id    String @id @default(cuid())
  title String
    description String
  price Int

  branch   Branch @relation(fields: [branchId], references: [id], onDelete: Cascade)
  branchId String

  transactions TransactionItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Transaction {
  id          String                @id @default(cuid())
  status      TransactionStatusEnum @default(PENDING)
  totalAmount Int

  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Restrict)
  customerId String

  servedBy   User?   @relation(fields: [servedById], references: [id], onDelete: SetNull)
  servedById String? 

  branch   Branch @relation(fields: [branchId], references: [id], onDelete: Restrict)
  branchId String

  items TransactionItem[]

  paymentMethod paymentMethodEnum 
  bookedAt DateTime
   
  grandTotal Int
  totalDiscount Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TransactionItem {
  id String @id @default(cuid())

  transaction   Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  transactionId String

  service       ServiceUnit @relation(fields: [serviceUnitId], references: [id], onDelete: Restrict)
  serviceUnitId String

  priceAtTransaction Int
  quantity           Int       @default(1)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([transactionId, serviceUnitId])
}

model Voucher {
id String @id @default(cuid())
code String @unique


createdAt DateTime
usedBy Customer @relation(fields: [usedByCustomerId], references: [id])
usedByCustomerId String

}

enum TransactionStatusEnum {
  DONE
  PENDING
  CANCELLED
}

enum paymentMethodEnum {
  EWALLET
  BANK
  CASH
}